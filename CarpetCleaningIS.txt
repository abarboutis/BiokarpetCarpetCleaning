[IMPORT]
MODULE=TSTORECUSTTRADE
DESTINATION=FINTRADE,STORETRADE,STORETRADELINES
READER=ATLANTIS

[ATLANTIS]
MAINTABLE=QRY1

[IMPORTSET]
QRY1=SELECT DISTINCT ERPCompID, AlpisStoreTransID,AlpisStoreTransDate, ERPTransSeriesID, ERPCustomerID,ERPSupplierID, ERPTransCode, 
ERPFromStoreID, ERPToStoreID, 1 AS LOCALRATE,1 AS CURID FROM ZCLEANINGCARPETSTRANS WHERE 
 doctype=1 AND  isnew = 1 AND ERPBRACHID=16 ORDER BY  AlpisStoreTransDate,AlpisStoreTransID,ERPCustomerID,ERPSupplierID ;
QRY2=SELECT  ACCERPITEMID,ERPItemID, ERPItemMUnit, ERPItemQty,ERPITEMSQTY, ERPItemUnitPrice, ERPItemQtyPrice,ERPPROFILECODE ,PROFILECOLORCODE,
ITEMLENGTH,ITEMMAINCATID,DISCPRICE,EXTRASERVICE   
FROM ZCLEANINGCARPETSTRANS  WHERE  isnew = 1 AND AlpisStoreTransID=:$AlpisStoreTransID;

[FINTRADE]
DSRID=QRY1.ERPTransSeriesID
CUSID=QRY1.ERPCustomerID
FTRDATE=QRY1.AlpisStoreTransDate
TRADECODE=QRY1.ERPTransCode
CURID=QRY1.CURID
LOCALRATE=QRY1.LOCALRATE
ZALPISSHIPPINGID=QRY1.AlpisStoreTransID

[STORETRADE]
STOID=QRY1.ERPFromStoreID
SECSTOID=QRY1.ERPToStoreID


[STORETRADELINES]
ITEID=QRY2.ERPItemID
PRIMARYQTY=QRY2.ERPITEMQTY
SECONDARYQTY=QRY2.ERPItemSQty
PRICE=QRY2.ERPItemUnitPrice
LINEVALUE=QRY2.ERPItemQtyPrice
ZTYPEID=QRY2.ITEMMAINCATID
PRDISC1=QRY2.DISCPRICE


[AFTERIMPORT]
UPDATE ZCLEANINGCARPETSTRANS SET ISNEW=0 WHERE DOCTYPE=1 AND ERPBRACHID=16;
COMMIT;


